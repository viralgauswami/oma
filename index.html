<!DOCTYPE html> 
<html> 
    <head> 
    <title>Select Job Page</title> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" href="css/jquery.mobile-1.0.css" />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/style.css" />
    
    <script src="jquery_002.js" type="text/javascript"></script>
	<script src="jquery_003.js" type="text/javascript"></script>
	<script src="jquery.js" type="text/javascript"></script>
	<link href="jquery.css" rel="stylesheet" type="text/css" media="screen">
   <script src="js/jquery-1.7.1.min.js"></script>
   
    <script src="js/cordova-2.5.0.js"></script>
    
    <script src="js/script.js"></script>
    <script src="js/jquery.mobile-1.0.min.js"></script>
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAiDNVH3xsDq4YPf8dMkHBzXrH17wF_JZw&sensor=false"> </script>
	<script type="text/javascript">
		$(document).ready(function() {
            $("a.logoff").click(function() {
                $.mobile.showPageLoadingMsg();
                $.ajax({
                    type: "POST",
                    url: config.service.baseurl + "/auth/logout",
                    data: {},
                    dataType: "json",
                    success: function(rsp) {
						$.mobile.hidePageLoadingMsg();
                        window.location.href = "login.html";
                    },
                    error: function(err) {
                        $.mobile.hidePageLoadingMsg();
						 jAlert('Your Session has expired,pleass Login.','');
					window.location.href = "login.html";
                        //alert("error while processing ...");
                    }
                });
            });
            
            $("#select-job").change(function() {
                                   
                if (!(id = $(this).val()))
                    return false;
                $.mobile.showPageLoadingMsg();
                $.ajax({
                    type: "POST",
                    url: config.service.baseurl + "/job/detail",
                    data: {
                        "id" : id
                    },
                    dataType: "json",
                    success: function(rsp) {
						$.mobile.hidePageLoadingMsg();
                        if (!rsp.auth) {
                            window.location.href = "login.html";
                            return;
                        }
                        $(".job-title .job_name").html(rsp.job.job_id);
                        $(".job-details .name").html(rsp.job.job_cust_name);
                        $(".job-details .address").html(rsp.job.job_cust_add + "<BR>" + rsp.job.country + "<BR>" + rsp.job.job_cust_city + ", " + rsp.job.state + "<BR>" + rsp.job.job_cust_zip);
                        $(".job-details .contact").html(rsp.job.job_cust_phone);
                        $(".job-details .phone").html(rsp.job.job_agent_phone);
                        $(".job-details .email").html(rsp.job.job_agent_email);
                        $(".job-note .note").html(rsp.job.job_notes);
                        $(".join-job").show();
                        var geocoder = new google.maps.Geocoder();
                        geocoder.geocode(
                            { 'address': rsp.job.job_cust_add + ',' + rsp.job.job_cust_city + ','  + rsp.job.job_cust_zip  },//This is hard coded to see the result since none of the job has perfect address. Please create the address in above format and then repalce this line with specific address compoenent : Hiren
                            function(results, status) {
                            if(results[0]){
                                var mapOptions = {
                                    center: new google.maps.LatLng(results[0].geometry.location.jb, results[0].geometry.location.kb),
                                    zoom: 15,
                                    mapTypeId: google.maps.MapTypeId.ROADMAP
                                };
                                var map = new google.maps.Map(document.getElementById("job-map"),mapOptions);
                                var marker = new google.maps.Marker({
                                    map: map,
                                    position: results[0].geometry.location
                                });
                            }
                        });
                       
                       
                        
                        
                    },
                    error: function(err) {
                        $.mobile.hidePageLoadingMsg();
                       // alert("error while processing ...");
					    jAlert('Your Session has expired,pleass Login.','');
					window.location.href = "login.html";
                    }
                });
            });
            
            $(".login").click(function() {
								if (!confirm("Are you sure you want job?"))
                    return false;
			 //if the user presses the "OK" button display the message "Javascript is cool!!" 
		 
			 
			// $.mobile.showPageLoadingMsg();
                            $.ajax({
                                type: "POST",
                                url: config.service.baseurl + "/job/login",
                                data: {
                                    "id": $("#select-job").val()
                                },
                                dataType: "json",
                                success: function(rsp) {
                                    $.mobile.hidePageLoadingMsg();
                                    if (!rsp.auth) {
                                        window.location.href = "job-setup.html";
                                        return;
                                    }
                                    if (rsp.login == "duplicate") {
                                        alert("The job assigned to another user. Please select other job.");
										 jAlert('The job assigned to another user. Please select other job.','');
			
                                        return;
                                    }
                                    window.location.href = rsp.redirect;
                                },
                                error: function(err) {
                                    $.mobile.hidePageLoadingMsg();
                                   // alert("error while processing ...");
								      jAlert('Your Session has expired,pleass Login.','');
										window.location.href = "login.html";
                                }
                            });
			 
			 
			 //otherwise display another message 
			 
			
			});
                          
            $.mobile.showPageLoadingMsg();
            $.ajax({
                type: "POST",
                url: config.service.baseurl + "/job/list",
                data: {},
                dataType: "json",
                success: function(rsp) {
					$.mobile.hidePageLoadingMsg();
                    if (!rsp.auth) {
                        window.location.href = "login.html";
                        return;
                    }
                    if (rsp.redirect) {
                        window.location.href = rsp.redirect;
                        return;
                    }
                    $(".header .account").html(rsp.date + "<BR>" + rsp.account);
                    $(rsp.jobs).each(function(i) {
                        $("#select-job").append("<option value='" + this.o_id + "'>" + this.jobid + "</option>");
                    });
                },
                error: function(err) {
                    $.mobile.hidePageLoadingMsg();
                    window.location.href = "login.html";
                }
            });
		});
		
	</script>
</head>
<body>
<div class="logo"><a><img src="images/logo.png" width="110" /></a></div>
<div data-role="page" data-theme="m">
    <div class="page-job">
        
        <div class="header">
            <div class="account"></div>
            <a class="logoff">LOGOFF</a>
        </div>
        
        <div class="content" data-role="content">
            <div class="select job">
                <select name="job" id="select-job" data-icon="arrow-r" data-iconpos="right">
                    <option value="">Select Job</option>
                </select>
            </div>
            <div class="job-title">
                <img src="images/job_txt.png" width="21" alt="Job Title" title="Job Title" />
                <div class="job-name"></div>
                <div class="join-job" id="loginButtonArea">
                    <input type="button" class="login" value="login" data-inline="true" data-shadow="false" />
                </div>
                <div class="clear"></div>
            </div>
            <div class="job-info">
                <div class="job-details">
                    <div class="item">
                        <label>Name</label>
                        <span class="name"></span>
                        <div class="clear"></div>
                    </div>
                    <div class="item">
                        <label>Address</label>
                        <span class="address"></span>
                        <div class="clear"></div>
                    </div>
                    <div class="item">
                        <label>Contact</label>
                        <span class="contact"></span>
                        <div class="clear"></div>
                    </div>
                    <div class="item">
                        <label>Phone</label>
                        <span class="phone"></span>
                        <div class="clear"></div>
                    </div>
                    <div class="item">
                        <label>Email</label>
                        <span class="email"></span>
                        <div class="clear"></div>
                    </div>
                </div>
                <div class="job-pos">
                    <div id="job-map"></div>
                </div>
                <div class="clear"></div>
            </div>
            <div class="job-note">
                <div class="item">
                    <label>Notes</label>
                    <span class="note"></span>
                    <div class="clear"></div>
                </div>
            </div>
        </div>
    </div>
</div>

</body>
</html>